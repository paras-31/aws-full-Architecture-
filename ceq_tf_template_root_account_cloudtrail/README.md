# CloudTrail

Terraform module to configure an AWS CloudTrail.

## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement_terraform) (>= 0.12.30)

- <a name="requirement_aws"></a> [aws](#requirement_aws) (~> 3.0)

- S3 bucket where Cloudtrail will store the logs. Bucket should have policy to allow

## Providers

| Name                                             | Version |
| ------------------------------------------------ | ------- |
| <a name="provider_aws"></a> [aws](#provider_aws) | n/a     |

## Modules

No modules.

## Resources

| Name                                                                                                                                                      | Type        |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [aws_cloudtrail.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail)                                             | resource    |
| [aws_cloudwatch_log_group.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group)                   | resource    |
| [aws_iam_policy.cloudtrail_cloudwatch_logs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_policy)                       | resource    |
| [aws_iam_role.cloudtrail_cloudwatch_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role)                           | resource    |
| [aws_iam_role_policy_attachment.cloudwatch_logs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment)  | resource    |
| [aws_kms_alias.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_alias)                                         | resource    |
| [aws_kms_key.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key)                                             | resource    |
| [aws_sns_topic.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic)                                         | resource    |
| [aws_sns_topic_policy.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic_policy)                           | resource    |
| [aws_sns_topic_subscription.topic_email_subscription](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic_subscription) | resource    |
| [aws_caller_identity.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity)                             | data source |
| [aws_iam_policy_document.cloudtrail_assume_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document)      | data source |
| [aws_iam_policy_document.cloudtrail_cloudwatch_logs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document)  | data source |
| [aws_iam_policy_document.cloudtrail_kms_key](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document)          | data source |
| [aws_iam_policy_document.cloudtrail_sns](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document)              | data source |
| [aws_kms_key.cloudtrail](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/kms_key)                                          | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region)                                               | data source |

## Inputs

| Name                                                                                                                                 | Description                                                                                                                                                                                                                                                                      | Type                                                                                                                                                                                   | Default | Required |
| ------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- | :------: |
| <a name="input_cloudwatch_logs_retention_in_days"></a> [cloudwatch_logs_retention_in_days](#input_cloudwatch_logs_retention_in_days) | Specifies the number of days you want to retain log events in the specified log group. Possible values are: 1, 3, 5, 7, 14, 30, 60, 90, 120, 150, 180, 365, 400, 545, 731, 1827, 3653, and 0. If you select 0, the events in the log group are always retained and never expire. | `number`                                                                                                                                                                               | `365`   |    no    |
| <a name="input_create_kms_key"></a> [create_kms_key](#input_create_kms_key)                                                          | Specifies whether to create kms key for cloudtrail and SNS. If 'kms_key_id' is set, need to set to 'false'.                                                                                                                                                                      | `bool`                                                                                                                                                                                 | `true`  |    no    |
| <a name="input_email"></a> [email](#input_email)                                                                                     | Subscription email                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                               | n/a     |   yes    |
| <a name="input_enable_cloudwatch_logs"></a> [enable_cloudwatch_logs](#input_enable_cloudwatch_logs)                                  | Enables Cloudtrail logs to write to ceated log group.                                                                                                                                                                                                                            | `bool`                                                                                                                                                                                 | `false` |    no    |
| <a name="input_enable_log_file_validation"></a> [enable_log_file_validation](#input_enable_log_file_validation)                      | Specifies whether log file integrity validation is enabled.                                                                                                                                                                                                                      | `bool`                                                                                                                                                                                 | `false` |    no    |
| <a name="input_enable_logging"></a> [enable_logging](#input_enable_logging)                                                          | Enables logging for the trail. Defaults to true. Setting this to false will pause logging.                                                                                                                                                                                       | `bool`                                                                                                                                                                                 | `false` |    no    |
| <a name="input_enable_sns_notifications"></a> [enable_sns_notifications](#input_enable_sns_notifications)                            | Specifies whether to create SNS topic and send notification of log file delivery.                                                                                                                                                                                                | `bool`                                                                                                                                                                                 | `false` |    no    |
| <a name="input_event_selectors"></a> [event_selectors](#input_event_selectors)                                                       | Specifies a list of event selectors for enabling data event logging. See: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#event_selector.                                                                                                 | <pre>list(object({<br> read_write_type = string<br> include_management_events = bool<br><br> data_resource = object({<br> type = string<br> values = list(string)<br> })<br> }))</pre> | `[]`    |    no    |
| <a name="input_include_global_service_events"></a> [include_global_service_events](#input_include_global_service_events)             | Specifies whether the trail is publishing events from global services such as IAM to the log files.                                                                                                                                                                              | `bool`                                                                                                                                                                                 | `false` |    no    |
| <a name="input_insight_selectors"></a> [insight_selectors](#input_insight_selectors)                                                 | Specifies a list of insight selectors for identifying unusual operational activity. See: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudtrail#insight_selector.                                                                                | <pre>list(object({<br> insight_type = string<br> }))</pre>                                                                                                                             | `[]`    |    no    |
| <a name="input_is_multi_region_trail"></a> [is_multi_region_trail](#input_is_multi_region_trail)                                     | Specifies whether the trail is created in the current region or in all regions.                                                                                                                                                                                                  | `bool`                                                                                                                                                                                 | `false` |    no    |
| <a name="input_is_organization_trail"></a> [is_organization_trail](#input_is_organization_trail)                                     | Specifies whether the trail is an AWS Organizations trail. Organization trails log events for the master account and all member accounts. Can only be created in the organization master account.                                                                                | `bool`                                                                                                                                                                                 | `false` |    no    |
| <a name="input_kms_key_deletion_window_in_days"></a> [kms_key_deletion_window_in_days](#input_kms_key_deletion_window_in_days)       | Duration in days after which the key is deleted after destruction of the resource, must be between 7 and 30 days. Defaults to 30 days.                                                                                                                                           | `number`                                                                                                                                                                               | `7`     |    no    |
| <a name="input_kms_key_id"></a> [kms_key_id](#input_kms_key_id)                                                                      | Specifies whether to use pre-created CMK. If used, set 'create_kms_key' to 'false'.                                                                                                                                                                                              | `string`                                                                                                                                                                               | `null`  |    no    |
| <a name="input_name"></a> [name](#input_name)                                                                                        | Namespace to be used on all resources                                                                                                                                                                                                                                            | `string`                                                                                                                                                                               | n/a     |   yes    |
| <a name="input_s3_bucket_name"></a> [s3_bucket_name](#input_s3_bucket_name)                                                          | Specifies the name of the S3 bucket designated for publishing log files.                                                                                                                                                                                                         | `string`                                                                                                                                                                               | n/a     |   yes    |
| <a name="input_s3_key_prefix"></a> [s3_key_prefix](#input_s3_key_prefix)                                                             | Specifies the S3 key prefix that follows the name of the bucket you have designated for log file delivery.                                                                                                                                                                       | `string`                                                                                                                                                                               | `null`  |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                        | A map of tags to assign to resources.                                                                                                                                                                                                                                            | `map(string)`                                                                                                                                                                          | `{}`    |    no    |

## Outputs

| Name                                                                                                              | Description                                                                          |
| ----------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------ |
| <a name="output_cloudtrail_arn"></a> [cloudtrail_arn](#output_cloudtrail_arn)                                     | The Amazon Resource Name of the Cloudtrail.                                          |
| <a name="output_cloudtrail_name"></a> [cloudtrail_name](#output_cloudtrail_name)                                  | The name of the Cloudtrail.                                                          |
| <a name="output_cloudtrail_sns_topic_arn"></a> [cloudtrail_sns_topic_arn](#output_cloudtrail_sns_topic_arn)       | Cloudtrail SNS topic ARN.                                                            |
| <a name="output_cloudwatch_logs_group_arn"></a> [cloudwatch_logs_group_arn](#output_cloudwatch_logs_group_arn)    | The log group ARN to which CloudTrail logs are delivered                             |
| <a name="output_cloudwatch_logs_group_name"></a> [cloudwatch_logs_group_name](#output_cloudwatch_logs_group_name) | The log group NAME to which CloudTrail logs are delivered                            |
| <a name="output_cloudwatch_logs_role_arn"></a> [cloudwatch_logs_role_arn](#output_cloudwatch_logs_role_arn)       | The IAM role ARN for the CloudWatch Logs endpoint to assume to write to a log group. |
| <a name="output_kms_key_id"></a> [kms_key_id](#output_kms_key_id)                                                 | The KMS key id created for trail events and SNS.                                     |
